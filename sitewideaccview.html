<!DOCTYPE html>
<html>
  <head>
      <title>Project: SMOD</title>
      <link rel="stylesheet" href="./styleV2.css">
      <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
      <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-firestore.js"></script>
      <script src=master_registry.js></script>
      <script>
        // Initialize Firebase
        var config = {
          apiKey: "AIzaSyClCIpY8LSqhGDMweZCGKgvExDKTp9PzEI",
          authDomain: "furthestring-149.firebaseapp.com",
          databaseURL: "https://furthestring-149.firebaseio.com",
          projectId: "furthestring-149",
          storageBucket: "furthestring-149.appspot.com",
          messagingSenderId: "545649936608"
        };
        firebase.initializeApp(config);

        var db = firebase.firestore();
      </script>
      <script type="text/javascript">
      initApp = function() {
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            // User is signed in.
            var displayName = user.displayName;
            var photoURL = user.photoURL;
            var providerData = user.providerData;
            var uid = user.uid;
            var workingData;
            user.getIdToken().then(function(accessToken) {
              document.getElementById('sign-in-status').textContent = 'You are currently signed in.';
              document.getElementById('sign-in').innerHTML = '<a href="./deauth.html">Sign out?</a>';
              db.collection("players").where("owner", "==", uid)
                .get()
                .then(function(querySnapshot) {
                    querySnapshot.forEach(function(doc) {
                        // doc.data() is never undefined for query doc snapshots
                        workingData = doc.data();
                        console.log(workingData);
                        document.getElementById("account-details").innerHTML += '<p>' + workingData.name + ', '
                          + getClassByID(workingData.class).sin + ' of '
                          + getAspectByID(workingData.aspect).sin + '</p>' + '<p> Level '
                          + workingData.level
                          + '<br /> Gel Viscosity: ' + calculateStatAtLevel(workingData.level, getClassByID(workingData.class).gelViscosity, getAspectByID(workingData.aspect).gelViscosity, 0)
                          + '<br /> Mangrit: ' + calculateStatAtLevel(workingData.level, getClassByID(workingData.class).manGrit, getAspectByID(workingData.aspect).manGrit, workingData.grit)
                          + '<br /> Speed: ' + calculateStatAtLevel(workingData.level, getClassByID(workingData.class).speed, getAspectByID(workingData.aspect).speed, workingData.spd)
                          + '<br /> Good Luck: ' + calculateStatAtLevel(workingData.level, getClassByID(workingData.class).goodLuck, getAspectByID(workingData.aspect).goodLuck, workingData.good)
                          + '<br /> Bad Luck: ' + calculateStatAtLevel(workingData.level, getClassByID(workingData.class).badLuck, getAspectByID(workingData.aspect).badLuck, workingData.bad)
                          + '<br /> Stealth: ' + calculateStatAtLevel(workingData.level, getClassByID(workingData.class).stealth, getAspectByID(workingData.aspect).stealth, workingData.stlth)
                          + '<br /> Willpower:' + calculateStatAtLevel(workingData.level, getClassByID(workingData.class).willPower, getAspectByID(workingData.aspect).willPower, workingData.will);
                          + '</p>';
                    });
                })
                .catch(function(error) {
                    console.log("Error getting documents: ", error);
                });
            });
          } else {
            // User is signed out.
            document.getElementById('sign-in-status').textContent = 'You are currently signed out.';
            document.getElementById('sign-in').innerHTML = '<a href="./authentication.html">Sign in?</a>';
            document.getElementById('account-details').textContent = 'Sign in to view account information.';
          }
        }, function(error) {
          console.log(error);
        });
      };

      window.addEventListener('load', function() {
        initApp()
      });
    </script>
  </head>
  <body>
    <div class="sidenav">
      <a href="#">Test 0</a>
      <a href="#">Test 1</a>
      <a href="#">Test 2</a>
      <a href="#">Test 3</a>
    </div>

    <div class="topBar">
      <p>
        <a href="https://backwards-n.github.io/index.html">Home</a> |
        <a href="https://backwards-n.github.io/sitewideaccview.html">Account</a> |
        <a href="https://backwards-n.github.io/SMOD/index.html">Project: SMOD</a>
      </p>
    </div>
    <div class="standard"><p id="sign-in-status"></p>
    <p id="sign-in"></p></div>
    <div id="account-details" class="standard"></div>
  </body>
</html>
